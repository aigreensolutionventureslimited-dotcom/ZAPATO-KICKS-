<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zapato Admin | Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --bg: #0a0a0a;
            --surface: #121212;
            --accent: #c5a059; /* Luxury Gold */
            --text: #ffffff;
            --gray: #888888;
            --border: rgba(255,255,255,0.05);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); -webkit-font-smoothing: antialiased; }

        /* Navigation */
        nav { padding: 30px 5%; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-family: 'Syne'; font-size: 0.9rem; letter-spacing: 4px; color: var(--accent); text-transform: uppercase; }

        .container { max-width: 1100px; margin: 0 auto; padding: 40px 5%; }

        /* Tabs */
        .tabs { display: flex; gap: 30px; margin-bottom: 40px; border-bottom: 1px solid var(--border); }
        .tab { padding-bottom: 15px; background: none; border: none; color: var(--gray); font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; transition: 0.3s; }
        .tab.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        .card { background: var(--surface); border: 1px solid var(--border); padding: 30px; margin-bottom: 30px; border-radius: 2px; }
        h2 { font-family: 'Syne'; font-size: 0.8rem; letter-spacing: 2px; margin-bottom: 25px; text-transform: uppercase; color: var(--accent); }

        /* Forms */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .field { display: flex; flex-direction: column; gap: 8px; }
        label { font-size: 0.55rem; color: var(--gray); text-transform: uppercase; letter-spacing: 1px; font-weight: 700; }
        input, select { background: #000; border: 1px solid #222; padding: 14px; color: #fff; font-size: 0.8rem; border-radius: 0; }
        
        .btn-gold { background: var(--accent); color: #000; border: none; padding: 16px 30px; font-weight: 800; font-size: 0.65rem; text-transform: uppercase; letter-spacing: 2px; cursor: pointer; transition: 0.3s; }
        .btn-gold:hover { opacity: 0.8; }
        .btn-gold:disabled { background: #333; cursor: not-allowed; }

        /* Table Style */
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; font-size: 0.55rem; color: var(--gray); padding: 15px; border-bottom: 1px solid var(--border); text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 15px; font-size: 0.75rem; border-bottom: 1px solid var(--border); color: #ccc; }
        .p-img { width: 40px; height: 40px; object-fit: cover; background: #000; }

        .link-box { background: #000; padding: 10px; border: 1px dashed var(--accent); color: var(--accent); font-size: 0.65rem; display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        
        .status-pill { padding: 4px 8px; font-size: 0.5rem; font-weight: 800; text-transform: uppercase; border-radius: 2px; }
        .pending { background: rgba(197, 160, 89, 0.1); color: var(--accent); }

        @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<nav>
    <div class="logo">Zapato Kicks Admin</div>
    <div style="font-size:0.5rem; color:var(--gray); letter-spacing:1px;">ACCESS GRANTED</div>
</nav>

<div class="container">
    <div class="tabs">
        <button class="tab active" onclick="showSec('inventory', this)">Inventory</button>
        <button class="tab" onclick="showSec('affiliates', this)">Affiliates</button>
        <button class="tab" onclick="showSec('sales', this)">Sales History</button>
    </div>

    <section id="sec-inventory">
        <div class="card">
            <h2>Add New Luxury Product</h2>
            <div class="form-grid">
                <div class="field"><label>Product Name</label><input type="text" id="p-name" placeholder="E.g. Balenciaga Runner"></div>
                <div class="field"><label>Category</label>
                    <select id="p-cat">
                        <option>Sneakers</option><option>Corporate</option><option>Palms</option><option>Slides</option>
                    </select>
                </div>
                <div class="field"><label>Price (₦)</label><input type="number" id="p-price" placeholder="120000"></div>
            </div>
            <div class="field" style="margin-bottom:20px;">
                <label>Product Images (Upload Multiple)</label>
                <input type="file" id="p-files" multiple accept="image/*" style="border:1px dashed #333; padding:30px; text-align:center;">
            </div>
            <button class="btn-gold" id="upBtn" onclick="uploadProduct()">Sync to Storefront</button>
        </div>

        <div class="card">
            <h2>Live Inventory</h2>
            <table id="inv-table">
                <thead><tr><th>Image</th><th>Name</th><th>Category</th><th>Price</th><th>Action</th></tr></thead>
                <tbody id="inv-body"></tbody>
            </table>
        </div>
    </section>

    <section id="sec-affiliates" style="display:none">
        <div class="card">
            <h2>Create New Affiliate</h2>
            <div class="form-grid">
                <div class="field"><label>Partner Name</label><input type="text" id="af-name" placeholder="E.g. Chidi"></div>
                <div class="field"><label>Unique Code</label><input type="text" id="af-code" placeholder="E.g. CHIDI10"></div>
            </div>
            <button class="btn-gold" onclick="addAffiliate()">Create Affiliate Link</button>
            <div id="link-display"></div>
        </div>

        <div class="card">
            <h2>Active Affiliates</h2>
            <table>
                <thead><tr><th>Partner</th><th>Code</th><th>Tracking Link</th></tr></thead>
                <tbody id="af-body"></tbody>
            </table>
        </div>
    </section>

    <section id="sec-sales" style="display:none">
        <div class="card">
            <h2>Recent Orders</h2>
            <table>
                <thead><tr><th>Date</th><th>Items</th><th>Amount</th><th>Affiliate</th><th>Status</th></tr></thead>
                <tbody id="sales-body"></tbody>
            </table>
        </div>
    </section>
</div>

<script>
const SB_URL = 'https://rvfuenrggxverrnnmcet.supabase.co';
const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ2ZnVlbnJnZ3h2ZXJybm5tY2V0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc4Njc2MTcsImV4cCI6MjA4MzQ0MzYxN30.aKCaWeXR1Le68waDqG_UHiOOZpkZYNC2FTTMutY-CqI';
const supa = supabase.createClient(SB_URL, SB_KEY);

function showSec(id, btn) {
    ['inventory', 'affiliates', 'sales'].forEach(s => document.getElementById('sec-'+s).style.display = 'none');
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    document.getElementById('sec-'+id).style.display = 'block';
    btn.classList.add('active');
    if(id === 'inventory') loadInventory();
    if(id === 'affiliates') loadAffiliates();
    if(id === 'sales') loadSales();
}

async function uploadProduct() {
    const btn = document.getElementById('upBtn');
    const files = document.getElementById('p-files').files;
    const name = document.getElementById('p-name').value;
    const price = document.getElementById('p-price').value;
    const cat = document.getElementById('p-cat').value;

    if(!name || !price || files.length === 0) return alert("Fill all fields");
    btn.disabled = true; btn.innerText = "UPLOADING...";

    try {
        let urls = [];
        for (let file of files) {
            const fName = `${Date.now()}_${file.name}`;
            const { data } = await supa.storage.from('product-images').upload(fName, file);
            const { data: pUrl } = supa.storage.from('product-images').getPublicUrl(fName);
            urls.push(pUrl.publicUrl);
        }
        await supa.from('products').insert([{ name, price, cat, image_url: urls.join(',') }]);
        alert("Product synced successfully");
        location.reload();
    } catch (e) { alert(e.message); btn.disabled = false; }
}

async function loadInventory() {
    const { data } = await supa.from('products').select('*').order('created_at', { ascending: false });
    document.getElementById('inv-body').innerHTML = data.map(p => `
        <tr>
            <td><img src="${p.image_url.split(',')[0]}" class="p-img"></td>
            <td>${p.name}</td>
            <td>${p.cat}</td>
            <td>₦${Number(p.price).toLocaleString()}</td>
            <td><button onclick="delP(${p.id})" style="color:red; background:none; border:none; cursor:pointer; font-size:0.6rem;">DELETE</button></td>
        </tr>
    `).join('');
}

async function delP(id) {
    if(confirm("Delete product?")) {
        await supa.from('products').delete().eq('id', id);
        loadInventory();
    }
}

// AFFILIATE LOGIC
async function addAffiliate() {
    const name = document.getElementById('af-name').value;
    const code = document.getElementById('af-code').value;
    if(!name || !code) return alert("Enter name and code");

    const { error } = await supa.from('affiliates').insert([{ name, code }]);
    if(error) return alert("Code already exists");

    const storeLink = `${window.location.origin}/index.html?ref=${code}`;
    document.getElementById('link-display').innerHTML = `
        <div class="link-box">
            <span>${storeLink}</span>
            <button onclick="navigator.clipboard.writeText('${storeLink}'); alert('Copied!')" style="background:none; border:none; color:#fff; cursor:pointer;">COPY</button>
        </div>
    `;
    loadAffiliates();
}

async function loadAffiliates() {
    const { data } = await supa.from('affiliates').select('*');
    document.getElementById('af-body').innerHTML = data.map(af => {
        const link = `${window.location.origin}/index.html?ref=${af.code}`;
        return `
            <tr>
                <td>${af.name}</td>
                <td style="color:var(--accent)">${af.code}</td>
                <td><span style="font-size:0.6rem; color:var(--gray);">${link}</span></td>
            </tr>
        `;
    }).join('');
}

async function loadSales() {
    const { data } = await supa.from('sales').select('*').order('created_at', { ascending: false });
    document.getElementById('sales-body').innerHTML = data.map(s => `
        <tr>
            <td>${new Date(s.created_at).toLocaleDateString()}</td>
            <td>${s.product_name.substring(0,25)}...</td>
            <td>₦${Number(s.amount).toLocaleString()}</td>
            <td><strong style="color:var(--accent)">${s.affiliate_code}</strong></td>
            <td><span class="status-pill pending">${s.status}</span></td>
        </tr>
    `).join('');
}

loadInventory();
</script>
</body>
</html>